// Generated by CoffeeScript 1.6.2
(function() {
  $($(function() {
    var $body, current_task, format_time, handle_task, set_background_blur, update_countdown;

    $body = $('body');
    current_task = null;
    $(document).bind('touchmove', false);
    set_background_blur = function(intensity) {
      return $('.background-wrapper').css('-webkit-filter', 'blur(' + (intensity * 10).toFixed(4) + 'px)').css('-webkit-transform', 'scale(' + (1 + intensity * 0.5).toFixed(4) + ')');
    };
    format_time = function(total_seconds) {
      var minutes, seconds;

      seconds = total_seconds % 60;
      minutes = Math.floor(total_seconds / 60);
      if (seconds < 10) {
        seconds = '0' + seconds;
      }
      if (minutes < 10) {
        minutes = '0' + minutes;
      }
      return "" + minutes + ":" + seconds;
    };
    update_countdown = function() {
      var seconds_left;

      seconds_left = Math.round((current_task.target_time - Date.now()) / 1000);
      $('#timer-countdown').text(format_time(seconds_left));
      set_background_blur(seconds_left / current_task.time);
      if (seconds_left > 0) {
        return window.setTimeout(update_countdown, 100);
      } else {
        $('#taskbutton').show();
        return $('#timer').hide();
      }
    };
    handle_task = function(task) {
      $('#timer').show();
      $('#taskdisplay').text(task.title);
      $('.background-wrapper').css('background-image', 'url(' + task.image.url + ')');
      $('#imagecredits').html(task.image.credits);
      $('#taskbutton').hide();
      task.target_time = Date.now() + task.time * 1000;
      current_task = task;
      return update_countdown();
    };
    return $('#taskbutton').click(function(e) {
      e.preventDefault();
      return $.getJSON('/task.json', function(task) {
        return handle_task(task);
      });
    });
  }));

}).call(this);
